<http ng-app="app">

    <head>
        <title>Home</title>
        <script src="scripts/vendor/angular.js"></script>
        <script src="scripts/vendor/firebase.js"></script>
        <script src="scripts/vendor/firebase-simple-login.js"></script>
        <script src="scripts/vendor/angularfire.js"></script>
    </head>

    <body>
        <div ng-controller="maincontroller">
            <button ng-show="loginObj.user" ng-click="logout()" style="float: right">logout</button>
            <h1>hello.</h1>
            <h5>{{ status }}</h5>
            <div ng-hide="loginObj.user">
                <form>
                    <input ng-disabled="logindisabled" type="email" ng-model="userlogin.email" placeholder="email" />
                    <input ng-disabled="logindisabled" type="password" ng-model="userlogin.password" placeholder="password" />
                    <button ng-disabled="logindisabled" type="submit" ng-click="login()">login</button>
                </form>
            </div>
            <div ng-show="loginObj.user">
                <form>
                    <input ng-model="newtask.description" type="text"/>
                    <button type="submit" ng-click="addtask()">add</button>
                </form>
                <table>
                    <tbody>
                        <tr ng-repeat="(key, task) in tasks">
                            <td style="min-width: 250px;">{{ task.description }}</td>
                            <td><button ng-click="removetask(key)">x</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <script>
            var myApp = angular.module('app', ['firebase']);

            function maincontroller($scope, $firebase, $firebaseSimpleLogin) {

                //if($location.host() == 'localhost') {
                //    $location.url('http://www.jkalweit.com', 'replace');
                //}

                $scope.logindisabled = true;

                var dataRef = new Firebase("https://jkalweit.firebaseio.com");
                $scope.loginObj = $firebaseSimpleLogin(dataRef);
                $scope.loginObj.$getCurrentUser().then(function (user) {
                    $scope.logindisabled = false;
                }, function (error) {
                    $scope.logindisabled = false;
                });


                var tasksRef = new Firebase("https://jkalweit.firebaseio.com/jkalweit/tasks");
                $scope.tasks = $firebase(tasksRef);

                $scope.login = function () {
                    $scope.logindisabled = true;
                    $scope.status = 'Logging in...';
                    $scope.loginObj.$login('password', {
                        email: $scope.userlogin.email,
                        password: $scope.userlogin.password
                    }).then(function (user) {
                                $scope.status = '';
                                $scope.logindisabled = false;
                            },
                            function (error) {
                                $scope.status = 'Failed to login: ' + error;
                                $scope.logindisabled = false;
                    });
                };

                $scope.logout = function () {
                    $scope.loginObj.$logout();
                };

                $scope.addtask = function () {
                    $scope.tasks.$add($scope.newtask).then(function () {
                        $scope.status = '';
                        $scope.newtask = {};
                    }, function (error) {
                        $scope.status = 'failed to add task: ' + error;
                    });
                };
                $scope.removetask = function (key) {
                    $scope.tasks.$remove(key).then(function () {
                        $scope.status = '';
                    }, function (error) {
                        $scope.status = 'failed to delete task: ' + error;
                    });
                };


            }
        </script>
    </body>

</http>
